# Detect pending for too long, assume something failed
alias: Detect too long pending state
trigger:
  - entity_id: input_boolean.home_cinema_pending
    platform: state
    to: 'on'
    # When pending for a while
    for:
      seconds: 30
action:
  # Reset pending (allows trying again)
  - condition: state
    entity_id: input_boolean.home_cinema_pending
    state: 'on'
  - entity_id: input_boolean.home_cinema_pending
    service: input_boolean.turn_off
  # Notify phone of Thijs
  - service: notify.mobile_app_phone_thijs
    data:
      title: >-
        Home cinema switch to {{ states("input_select.home_cinema_mode") }} failed
      message: It was still pending after 30 seconds, loading state has been reset
      data:
        tag: battery
